<!DOCTYPE html>
<html lang="id" prefix="og: https://ogp.me/ns#">
<head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>{{ page.title | default: "VIN NESIA Tools - Koleksi Tools Online Gratis" }}</title>
    <meta name="description" content="{{ page.description | default: 'Koleksi lengkap tools online gratis untuk kebutuhan sehari-hari. BMI Calculator, QR Generator, dan berbagai tools berguna lainnya.' }}">
    <meta name="keywords" content="{{ page.keywords | default: 'tools online, kalkulator, generator, converter, gratis, indonesia' }}">
    <meta name="author" content="VIN NESIA Tools">
    <meta name="robots" content="index, follow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.canonical_url | default: site.url }}{{ page.url }}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{{ page.og_type | default: 'website' }}">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:title" content="{{ page.title | default: site.title }}">
    <meta property="og:description" content="{{ page.description | default: site.description }}">
    <meta property="og:image" content="{{ page.og_image | default: site.url }}/assets/images/og-image.jpg">
    <meta property="og:site_name" content="VIN NESIA Tools">
    <meta property="og:locale" content="id_ID">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
    <meta name="twitter:title" content="{{ page.title | default: site.title }}">
    <meta name="twitter:description" content="{{ page.description | default: site.description }}">
    <meta name="twitter:image" content="{{ page.twitter_image | default: site.url }}/assets/images/twitter-card.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2563eb">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.google-analytics.com">
    
    <!-- CSS Files -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "VIN NESIA Tools",
        "url": "{{ site.url }}",
        "description": "Koleksi lengkap tools online gratis untuk kebutuhan sehari-hari",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "{{ site.url }}/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    
    <!-- Google Analytics -->
    {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
    
    <!-- Additional Head Content -->
    {{ page.extra_head | default: "" }}
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- Loading Indicator -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Skip to Main Content (Accessibility) -->
    <a href="#main-content" class="skip-link visually-hidden-focusable">Skip to main content</a>

    <!-- Header -->
    <header class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <!-- Logo/Brand -->
            <a class="navbar-brand fw-bold text-primary" href="/">
                <img src="/assets/images/logo.svg" alt="VIN NESIA Tools Logo" height="32" class="me-2">
                VIN NESIA Tools
            </a>

            <!-- Mobile Menu Toggle -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navigation Menu -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <nav class="navbar-nav ms-auto">
                    <a class="nav-link{{ page.url == '/' ? ' active' : '' }}" href="/" aria-current="{{ page.url == '/' ? 'page' : 'false' }}">
                        <i class="fas fa-home me-1"></i>Home
                    </a>
                    <a class="nav-link{{ page.url contains '/bmi-calculator' ? ' active' : '' }}" href="/bmi-calculator">
                        <i class="fas fa-calculator me-1"></i>BMI Calculator
                    </a>
                    <a class="nav-link{{ page.url contains '/qr-generator' ? ' active' : '' }}" href="/qr-generator">
                        <i class="fas fa-qrcode me-1"></i>QR Generator
                    </a>
                    <a class="nav-link{{ page.url contains '/color-picker' ? ' active' : '' }}" href="/color-picker">
                        <i class="fas fa-palette me-1"></i>Color Picker
                    </a>
                    <a class="nav-link{{ page.url contains '/password-generator' ? ' active' : '' }}" href="/password-generator">
                        <i class="fas fa-key me-1"></i>Password Gen
                    </a>
                    <a class="nav-link{{ page.url contains '/tools' ? ' active' : '' }}" href="/tools">
                        <i class="fas fa-tools me-1"></i>All Tools
                    </a>
                    <a class="nav-link{{ page.url contains '/about' ? ' active' : '' }}" href="/about">
                        <i class="fas fa-info-circle me-1"></i>About
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow-1">
        <!-- Breadcrumb (if enabled) -->
        {% if page.breadcrumb != false %}
        <nav aria-label="breadcrumb" class="bg-light py-2">
            <div class="container">
                <ol class="breadcrumb mb-0 small">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    {% assign url_parts = page.url | split: '/' %}
                    {% assign current_path = '' %}
                    {% for part in url_parts %}
                        {% unless part == '' %}
                            {% assign current_path = current_path | append: '/' | append: part %}
                            {% if forloop.last %}
                                <li class="breadcrumb-item active" aria-current="page">{{ page.title | default: part | capitalize }}</li>
                            {% else %}
                                <li class="breadcrumb-item"><a href="{{ current_path }}">{{ part | capitalize }}</a></li>
                            {% endif %}
                        {% endunless %}
                    {% endfor %}
                </ol>
            </div>
        </nav>
        {% endif %}

        <!-- Page Content -->
        <div class="container py-4">
            {{ content }}
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-auto">
        <div class="container py-5">
            <div class="row g-4">
                <!-- Brand & Description -->
                <div class="col-lg-4">
                    <h5 class="fw-bold mb-3">VIN NESIA Tools</h5>
                    <p class="text-light-50 mb-3">
                        Koleksi lengkap tools online gratis untuk memudahkan aktivitas digital Anda. 
                        Semua tools dapat digunakan langsung di browser tanpa instalasi.
                    </p>
                    <div class="social-links">
                        <a href="https://facebook.com/vinnesiatools" class="text-light me-3" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/vinnesiatools" class="text-light me-3" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://instagram.com/vinnesiatools" class="text-light me-3" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://github.com/vinnesiatools" class="text-light" aria-label="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                    </div>
                </div>

                <!-- Popular Tools -->
                <div class="col-lg-2">
                    <h6 class="fw-bold mb-3">Popular Tools</h6>
                    <ul class="list-unstyled">
                        <li><a href="/bmi-calculator" class="text-light-75 text-decoration-none">BMI Calculator</a></li>
                        <li><a href="/qr-generator" class="text-light-75 text-decoration-none">QR Generator</a></li>
                        <li><a href="/color-picker" class="text-light-75 text-decoration-none">Color Picker</a></li>
                        <li><a href="/password-generator" class="text-light-75 text-decoration-none">Password Gen</a></li>
                        <li><a href="/url-shortener" class="text-light-75 text-decoration-none">URL Shortener</a></li>
                    </ul>
                </div>

                <!-- Categories -->
                <div class="col-lg-2">
                    <h6 class="fw-bold mb-3">Categories</h6>
                    <ul class="list-unstyled">
                        <li><a href="/tools/generators" class="text-light-75 text-decoration-none">Generators</a></li>
                        <li><a href="/tools/calculators" class="text-light-75 text-decoration-none">Calculators</a></li>
                        <li><a href="/tools/converters" class="text-light-75 text-decoration-none">Converters</a></li>
                        <li><a href="/tools/utilities" class="text-light-75 text-decoration-none">Utilities</a></li>
                        <li><a href="/tools" class="text-light-75 text-decoration-none">All Tools</a></li>
                    </ul>
                </div>

                <!-- Company -->
                <div class="col-lg-2">
                    <h6 class="fw-bold mb-3">Company</h6>
                    <ul class="list-unstyled">
                        <li><a href="/about" class="text-light-75 text-decoration-none">About Us</a></li>
                        <li><a href="/contact" class="text-light-75 text-decoration-none">Contact</a></li>
                        <li><a href="/privacy" class="text-light-75 text-decoration-none">Privacy Policy</a></li>
                        <li><a href="/terms" class="text-light-75 text-decoration-none">Terms of Service</a></li>
                        <li><a href="/sitemap.xml" class="text-light-75 text-decoration-none">Sitemap</a></li>
                    </ul>
                </div>

                <!-- Newsletter -->
                <div class="col-lg-2">
                    <h6 class="fw-bold mb-3">Stay Updated</h6>
                    <p class="text-light-75 small mb-3">Get notified about new tools and updates</p>
                    <div class="mb-3">
                        <input type="email" class="form-control form-control-sm" placeholder="Your email" id="newsletter-email">
                        <button class="btn btn-primary btn-sm mt-2 w-100" type="button" onclick="subscribeNewsletter()">
                            Subscribe
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bottom Bar -->
            <hr class="my-4 border-secondary">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 text-light-50 small">
                        &copy; 2024 VIN NESIA Tools. All rights reserved.
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <span class="text-light-50 small">
                        Made with <i class="fas fa-heart text-danger"></i> in Indonesia
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="btn btn-primary back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- Cookie Consent Banner -->
    <div id="cookieConsent" class="cookie-consent">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <p class="mb-0">
                        <i class="fas fa-cookie-bite me-2"></i>
                        Kami menggunakan cookie untuk meningkatkan pengalaman Anda. 
                        <a href="/privacy" class="text-decoration-none">Pelajari lebih lanjut</a>
                    </p>
                </div>
                <div class="col-md-4 text-md-end mt-2 mt-md-0">
                    <button class="btn btn-outline-light btn-sm me-2" onclick="declineCookies()">Tolak</button>
                    <button class="btn btn-light btn-sm" onclick="acceptCookies()">Terima</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/main.js"></script>
    
    <!-- Service Worker for PWA (with error handling) -->
    <script>
        if ('serviceWorker' in navigator && window.location.hostname !== 'www.claudeusercontent.com') {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    <!-- Additional Scripts -->
    <script>
        // Safe localStorage helper functions
        function safeSetStorage(key, value) {
            try {
                if (typeof(Storage) !== "undefined" && localStorage) {
                    localStorage.setItem(key, value);
                    return true;
                }
            } catch (e) {
                console.warn('localStorage not available:', e);
            }
            return false;
        }

        function safeGetStorage(key) {
            try {
                if (typeof(Storage) !== "undefined" && localStorage) {
                    return localStorage.getItem(key);
                }
            } catch (e) {
                console.warn('localStorage not available:', e);
            }
            return null;
        }

        // In-memory storage fallback
        let memoryStorage = {};

        function setMemoryStorage(key, value) {
            memoryStorage[key] = value;
        }

        function getMemoryStorage(key) {
            return memoryStorage[key] || null;
        }

        // Universal storage functions
        function setStorage(key, value) {
            if (!safeSetStorage(key, value)) {
                setMemoryStorage(key, value);
            }
        }

        function getStorage(key) {
            const localValue = safeGetStorage(key);
            return localValue !== null ? localValue : getMemoryStorage(key);
        }

        // Loading indicator
        window.addEventListener('load', function() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        });

        // Back to top functionality
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (backToTop) {
                if (window.pageYOffset > 300) {
                    backToTop.style.display = 'block';
                } else {
                    backToTop.style.display = 'none';
                }
            }
        });

        // Back to top click handler
        document.addEventListener('DOMContentLoaded', function() {
            const backToTopBtn = document.getElementById('backToTop');
            if (backToTopBtn) {
                backToTopBtn.addEventListener('click', function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
        });

        // Cookie consent functions
        function acceptCookies() {
            setStorage('cookieConsent', 'accepted');
            const consentBanner = document.getElementById('cookieConsent');
            if (consentBanner) {
                consentBanner.style.display = 'none';
            }
        }

        function declineCookies() {
            setStorage('cookieConsent', 'declined');
            const consentBanner = document.getElementById('cookieConsent');
            if (consentBanner) {
                consentBanner.style.display = 'none';
            }
        }

        // Check cookie consent status
        window.addEventListener('load', function() {
            const consentBanner = document.getElementById('cookieConsent');
            if (consentBanner && !getStorage('cookieConsent')) {
                setTimeout(() => {
                    consentBanner.style.display = 'block';
                }, 2000);
            } else if (consentBanner) {
                consentBanner.style.display = 'none';
            }
        });

        // Newsletter subscription
        function subscribeNewsletter() {
            const emailInput = document.getElementById('newsletter-email');
            if (!emailInput) return;
            
            const email = emailInput.value.trim();
            if (email && email.includes('@') && email.includes('.')) {
                alert('Terima kasih! Anda telah berlangganan newsletter kami.');
                emailInput.value = '';
            } else {
                alert('Mohon masukkan email yang valid.');
            }
        }

        // Enhanced lazy loading for images with fallback
        function initLazyLoading() {
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src) {
                                img.src = img.dataset.src;
                                img.classList.remove('lazy');
                                img.classList.add('loaded');
                                observer.unobserve(img);
                            }
                        }
                    });
                });

                document.querySelectorAll('img[data-src]').forEach(img => {
                    imageObserver.observe(img);
                });
            } else {
                // Fallback for older browsers
                document.querySelectorAll('img[data-src]').forEach(img => {
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    img.classList.add('loaded');
                });
            }
        }

        // Initialize lazy loading when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initLazyLoading);
        } else {
            initLazyLoading();
        }

        // Error handling for missing elements
        window.addEventListener('error', function(e) {
            console.warn('Script error handled:', e.error);
        });
    </script>

    {{ page.extra_scripts | default: "" }}
</body>
</html>
